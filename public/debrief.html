<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Participant Debrief Sheet</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .debrief-content {
            max-height: 70vh;
            overflow-y: auto;
            padding: 1.5rem;
            border: 1px solid #e1e8ed;
            border-radius: 8px;
            margin-bottom: 2rem;
            background-color: #fafafa;
            line-height: 1.6;
        }
        
        .debrief-content h1 {
            color: #1a73e8;
            margin-top: 0;
            margin-bottom: 1rem;
            font-size: 1.5rem;
            text-align: center;
        }
        
        .debrief-content h2 {
            color: #1a73e8;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            font-size: 1.2rem;
        }
        
        .debrief-content p {
            margin-bottom: 1rem;
            color: #333;
        }
        
        .debrief-content ul {
            margin-bottom: 1rem;
            padding-left: 1.5rem;
        }
        
        .debrief-content li {
            margin-bottom: 0.5rem;
        }
        
        .contact-info {
            background-color: #f8f9ff;
            border: 1px solid #d4e3fc;
            padding: 1rem;
            border-radius: 6px;
            margin: 1rem 0;
        }
        
        .contact-info strong {
            display: block;
            margin-bottom: 0.5rem;
        }
        
        .contact-link {
            color: #1a73e8;
            text-decoration: none;
        }
        
        .contact-link:hover {
            text-decoration: underline;
        }
        
        .download-section {
            text-align: center;
            margin: 2rem 0;
            padding: 1rem;
            border-top: 1px solid #e1e8ed;
        }
        
        .download-link {
            color: #1a73e8;
            text-decoration: underline;
            cursor: pointer;
            font-size: 0.95rem;
            margin-bottom: 1.5rem;
            display: inline-block;
        }
        
        .download-link:hover {
            color: #0d47a1;
        }
        
        .submit-section {
            text-align: center;
            margin-top: 2rem;
            padding: 1.5rem;
            background-color: #f8f9ff;
            border: 2px solid #1a73e8;
            border-radius: 8px;
        }
        
        .btn-submit {
            background-color: #1a73e8;
            color: white;
            border: none;
            padding: 1rem 2rem;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 6px;
            cursor: pointer;
            min-width: 250px;
            transition: background-color 0.2s ease;
        }
        
        .btn-submit:hover {
            background-color: #0d47a1;
        }
        
        .btn-submit:focus {
            outline: 2px solid #4285f4;
            outline-offset: 2px;
        }
        
        .study-title {
            font-style: italic;
            color: #666;
            margin-bottom: 1.5rem;
        }
        
        .thank-you {
            font-size: 1.1rem;
            font-weight: 500;
            color: #1a73e8;
            margin-bottom: 1.5rem;
        }
        
        .completion-code-section {
            text-align: center;
            margin: 2rem 0 1rem 0;
        }
        
        .completion-code-box {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 0 auto;
            max-width: 400px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .completion-text {
            margin: 0 0 1rem 0;
            color: #155724;
            font-size: 1rem;
            font-weight: 500;
        }
        
        .completion-code-button {
            font-family: 'Courier New', Monaco, monospace;
            font-size: 1.5rem;
            font-weight: bold;
            color: #155724;
            background-color: #f8f9fa;
            border: 1px solid #c3e6cb;
            border-radius: 4px;
            padding: 0.75rem;
            margin: 0;
            cursor: pointer;
            letter-spacing: 2px;
            transition: all 0.2s ease;
            display: block;
            width: 100%;
        }
        
        .completion-code-button:hover {
            background-color: #e9ecef;
            border-color: #a3c7a3;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .completion-code-button:active {
            transform: translateY(0);
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        
        .copy-instruction-inside {
            margin: 0.75rem 0 0 0;
            color: #666;
            font-size: 0.875rem;
        }
        
        .toast-notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #155724;
            color: white;
            padding: 1rem 2rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }
        
        .toast-notification.show {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Study Debrief</h1>
        </div>
        
        <div class="content">
            <div class="debrief-content" id="debriefContent">
                <h1>Participant Debrief Sheet</h1>
                
                <p class="study-title"><strong>Study Title:</strong> Examining Belief Change Narratives through Dialogues with AI</p>
                
                <p class="thank-you">Thank you for participating in our research study. We appreciate the time and effort you've contributed to this important research.</p>
                
                <h2>Purpose of the Study</h2>
                <p>The primary aim of this study was to investigate people's changes of mind and belief towards topics relating to technology and science.</p>
                
                <h2>What We Did</h2>
                <p>In this study, you completed surveys about your attitudes toward climate change and interacted with an AI chatbot. The AI you interacted with was not programmed to persuade you in any particular direction, but rather to engage in an open-ended dialogue.</p>
                
                <h2>Factual Information</h2>
                <p>To ensure you have access to reliable information about climate change, we recommend consulting the following reputable source:</p>
                <ul>
                    <li>The Intergovernmental Panel on Climate Change.</li>
                </ul>
                
                <h2>Why This Research is Important</h2>
                <p>Understanding attitudes towards climate change and the reasons why people change their minds about climate change helps us understand how beliefs and opinions change and evolve.</p>
                
                <h2>Confidentiality Reminder</h2>
                <p>As a reminder, all the data collected in this study will be kept confidential and anonymous. Your responses will not be identifiable in any published results.</p>
                <h2>Further Questions or Concerns</h2>
                <p>If you have any questions about this research or your participation, please don't hesitate to contact the lead researcher:</p>
                
                <div class="contact-info">
                    <strong>David Cheney</strong>
                    Email: <a href="mailto:d.cheney@uq.edu.au" class="contact-link">d.cheney@uq.edu.au</a>
                </div>
                
                <p>If you have any concerns about the ethical conduct of this research, you may contact the University of Queensland Ethics Coordinator on <a href="tel:+61733653924" class="contact-link">+617 3365 3924</a> or email <a href="mailto:humanethics@research.uq.edu.au" class="contact-link">humanethics@research.uq.edu.au</a>.</p>
                
                <p><strong>Please click the button below to be redirected back to Prolific to register your submission</strong></p>
            </div>
            
            
            <div class="completion-code-section">
                <div class="completion-code-box">
                    <p class="completion-text">Your Prolific completion code is:</p>
                    <button class="completion-code-button" id="completionCode">CNCTZ833</button>
                    <p class="copy-instruction-inside">Click the code above to copy it</p>
                </div>
            </div>
            
            <div class="submit-section">
                <button type="button" class="btn-submit" id="submitBtn">Submit and Return to Prolific</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Always initialize the functionality, regardless of session data
            initializeCopyToClipboard();
            initializeSubmit();
            
            // Optional check for completion tracking (don't block functionality)
            const participantId = sessionStorage.getItem('participant_id');
            if (!participantId) {
                console.log('No participant ID found - participant may have navigated directly to debrief page');
            }
        });
        
        
        function initializeSubmit() {
            const submitBtn = document.getElementById('submitBtn');
            
            if (!submitBtn) {
                console.error('Submit button not found');
                return;
            }
            
            console.log('Submit button found, adding event listener');
            
            submitBtn.addEventListener('click', function(e) {
                e.preventDefault();
                console.log('Submit button clicked');
                
                // Disable button during redirect
                submitBtn.disabled = true;
                submitBtn.textContent = 'Redirecting...';
                
                try {
                    // Use the official Prolific completion URL with the completion code
                    const completionCode = 'CNCTZ833';
                    const prolificCompletionUrl = `https://app.prolific.com/submissions/complete?cc=${completionCode}`;
                    
                    console.log('Redirecting to Prolific completion URL:', prolificCompletionUrl);
                    
                    // Small delay to show the "Redirecting..." text
                    setTimeout(() => {
                        window.location.href = prolificCompletionUrl;
                    }, 100);
                    
                } catch (error) {
                    console.error('Error redirecting to Prolific:', error);
                    
                    // Re-enable button on error
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Submit and Return to Prolific';
                    
                    alert('There was an error redirecting to Prolific. Please manually navigate to Prolific and enter the completion code: CNCTZ833');
                }
            });
            
            console.log('Submit button event listener added successfully');
        }
        
        function initializeCopyToClipboard() {
            const completionCodeButton = document.getElementById('completionCode');
            
            if (!completionCodeButton) {
                console.error('Completion code button not found');
                return;
            }
            
            completionCodeButton.addEventListener('click', async function(e) {
                e.preventDefault();
                console.log('Button clicked'); // Debug log
                
                try {
                    const completionCode = this.textContent.trim();
                    console.log('Copying code:', completionCode); // Debug log
                    
                    // Use modern clipboard API if available
                    if (navigator.clipboard && window.isSecureContext) {
                        await navigator.clipboard.writeText(completionCode);
                        console.log('Copied using modern API'); // Debug log
                    } else {
                        // Fallback for older browsers
                        const textArea = document.createElement('textarea');
                        textArea.value = completionCode;
                        textArea.style.position = 'fixed';
                        textArea.style.left = '-999999px';
                        textArea.style.top = '-999999px';
                        document.body.appendChild(textArea);
                        textArea.focus();
                        textArea.select();
                        const successful = document.execCommand('copy');
                        textArea.remove();
                        console.log('Fallback copy successful:', successful); // Debug log
                    }
                    
                    // Show toast notification
                    showToastNotification('Copied to clipboard!');
                    
                } catch (error) {
                    console.error('Failed to copy completion code:', error);
                    // Show error toast
                    showToastNotification('Failed to copy - please try selecting manually');
                }
            });
            
            // Add keyboard accessibility
            completionCodeButton.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    this.click();
                }
            });
            
            // Add title attribute for tooltip
            completionCodeButton.setAttribute('title', 'Click to copy to clipboard');
            completionCodeButton.setAttribute('aria-label', 'Copy completion code to clipboard');
            
            console.log('Copy to clipboard initialized'); // Debug log
        }
        
        function showToastNotification(message) {
            console.log('Showing toast:', message); // Debug log
            
            // Create toast element
            const toast = document.createElement('div');
            toast.className = 'toast-notification';
            toast.textContent = message;
            
            // Add to document
            document.body.appendChild(toast);
            
            // Show with slight delay for smooth animation
            setTimeout(() => {
                toast.classList.add('show');
            }, 100);
            
            // Hide after 2.5 seconds
            setTimeout(() => {
                toast.classList.remove('show');
                
                // Remove from DOM after animation completes
                setTimeout(() => {
                    if (document.body.contains(toast)) {
                        document.body.removeChild(toast);
                    }
                }, 300);
            }, 2500);
        }
        
        // Keyboard accessibility for submit button
        document.getElementById('submitBtn').addEventListener('keypress', function(e) {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                this.click();
            }
        });
        
        // Prevent back navigation by disabling browser back button
        window.addEventListener('popstate', function(e) {
            e.preventDefault();
            if (confirm('Are you sure you want to leave? Your study completion may not be recorded.')) {
                // Allow navigation if user really wants to go back
                window.history.back();
            } else {
                // Push the current state back to prevent navigation
                window.history.pushState(null, '', window.location.href);
            }
        });
        
        // Push initial state to enable back button prevention
        window.history.pushState(null, '', window.location.href);
    </script>
</body>
</html>